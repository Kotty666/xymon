--- a/hobbitd/hobbitd.c
+++ b/hobbitd/hobbitd.c
@@ -921,7 +921,7 @@ hobbitd_log_t *find_cookie(int cookie)
 
 	dbgprintf("-> find_cookie\n");
 
-	cookiehandle = rbtFind(rbcookies, (void *)cookie);
+	cookiehandle = rbtFind(rbcookies, (void *)&cookie);
 	if (cookiehandle != rbtEnd(rbcookies)) {
 		result = gettreeitem(rbcookies, cookiehandle);
 		if (result->cookieexpires <= time(NULL)) result = NULL;
@@ -938,7 +938,7 @@ void clear_cookie(hobbitd_log_t *log)
 
 	if (log->cookie <= 0) return;
 
-	cookiehandle = rbtFind(rbcookies, (void *)log->cookie);
+	cookiehandle = rbtFind(rbcookies, (void *)&log->cookie);
 	log->cookie = -1; log->cookieexpires = 0;
 
 	if (cookiehandle == rbtEnd(rbcookies)) return;
@@ -1134,7 +1134,7 @@ void handle_status(unsigned char *msg, c
 			} while (find_cookie(newcookie));
 
 			log->cookie = newcookie;
-			rbtInsert(rbcookies, (void *)newcookie, log);
+			rbtInsert(rbcookies, (void *)&log->cookie, log);
 
 			/*
 			 * This is fundamentally flawed. The cookie should be generated by
@@ -3712,7 +3712,7 @@ void load_checkpoint(char *fn)
 		else 
 			ltail->ackmsg = NULL;
 		ltail->cookie = cookie;
-		if (cookie > 0) rbtInsert(rbcookies, (void *)cookie, ltail);
+		if (cookie > 0) rbtInsert(rbcookies, (void *)&ltail->cookie, ltail);
 		ltail->cookieexpires = cookieexpires;
 		ltail->metas = NULL;
 		ltail->acklist = NULL;
